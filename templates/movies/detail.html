{% extends "base.html" %}
{% block title %}Detail Film{% endblock %}
{% block content %}

<!-- DETAIL FILM -->
<div class="row mb-4">
  <div class="col-md-4">
    {% if movie.Poster != "N/A" %}
      <img src="{{ movie.Poster }}" class="img-fluid rounded shadow">
    {% endif %}
  </div>

  <div class="col-md-8">
    <h2>{{ movie.Title }} ({{ movie.Year }})</h2>

    <!-- BOOKMARK STATUS -->
    {% if user.is_authenticated %}
      {% if is_bookmarked %}
        <span class="badge bg-success mb-2">
          ‚úî Sudah dibookmark
        </span>

        <form
          method="post"
          action="{% url 'remove_bookmark' movie.imdbID %}"
          class="mt-2"
        >
          {% csrf_token %}
          <button class="btn btn-outline-danger btn-sm">
            üóëÔ∏è Hapus Bookmark
          </button>
        </form>
      {% else %}
        <form
          method="post"
          action="{% url 'add_bookmark' %}"
          class="mt-2"
        >
          {% csrf_token %}
          <input type="hidden" name="imdb_id" value="{{ movie.imdbID }}">
          <input type="hidden" name="title" value="{{ movie.Title }}">
          <input type="hidden" name="poster" value="{{ movie.Poster }}">

          <button class="btn btn-outline-warning btn-sm">
            ‚≠ê Simpan ke Bookmark
          </button>
        </form>
      {% endif %}
    {% else %}
      <p>
        <a href="/accounts/login/">Login</a> untuk menyimpan film
      </p>
    {% endif %}

    <p class="mt-3"><strong>Genre:</strong> {{ movie.Genre }}</p>
    <p><strong>Durasi:</strong> {{ movie.Runtime }}</p>
    <p><strong>IMDb:</strong> ‚≠ê {{ movie.imdbRating }}</p>
    <p>{{ movie.Plot }}</p>
  </div>
</div>

<hr>

<!-- STAR RATING STYLE -->
<style>
  .star-rating {
    direction: rtl;
    display: inline-flex;
    font-size: 1.8rem;
  }
  .star-rating input {
    display: none;
  }
  .star-rating label {
    color: #ccc;
    cursor: pointer;
  }
  .star-rating input:checked ~ label,
  .star-rating label:hover,
  .star-rating label:hover ~ label {
    color: gold;
  }
</style>

<!-- REVIEW FORM -->
{% if user.is_authenticated %}
<h4>Tambah Review</h4>

<form method="post" action="{% url 'add_review' %}" class="mb-4">
  {% csrf_token %}
  <input type="hidden" name="imdb_id" value="{{ movie.imdbID }}">

  <div class="mb-3">
    <label>Rating</label><br>
    <div class="star-rating">
      <input type="radio" name="rating" value="5" id="star5" required><label for="star5">‚òÖ</label>
      <input type="radio" name="rating" value="4" id="star4"><label for="star4">‚òÖ</label>
      <input type="radio" name="rating" value="3" id="star3"><label for="star3">‚òÖ</label>
      <input type="radio" name="rating" value="2" id="star2"><label for="star2">‚òÖ</label>
      <input type="radio" name="rating" value="1" id="star1"><label for="star1">‚òÖ</label>
    </div>
  </div>

  <div class="mb-3">
    <label>Komentar</label>
    <textarea name="comment" class="form-control" required></textarea>
  </div>

  <button class="btn btn-success">Kirim Review</button>
</form>
{% endif %}

<hr>

<!-- REVIEW LIST -->
<h4>Review Pengguna</h4>

{% for review in reviews %}
  <div class="card mb-3">
    <div class="card-body">
      <strong>{{ review.user.username }}</strong>
      <div>
        {% for i in "12345" %}
          {% if forloop.counter <= review.rating %}‚≠ê{% else %}‚òÜ{% endif %}
        {% endfor %}
      </div>
      <p>{{ review.comment }}</p>
    </div>
  </div>
{% empty %}
  <p>Belum ada review.</p>
{% endfor %}

{% endblock %}
